

\documentclass[paper=a4, fontsize=11pt]{article}
\usepackage{amsmath,amsfonts}
\usepackage{amsthm}


\title{
Inversion of altimetry timeseries for basal perturbations: theory
and synthetic experiments
}

\author{ Aaron Stubblefield (Columbia University)} % Your name

\date{\small\today} % Today's date or a custom date

\begin{document}

\maketitle % Print the title

\section*{Overview}

\subsection*{Assumptions}
\begin{itemize}
\item Newtonian viscosity $\eta$
\item linear sliding law at the base for grounded ice, with friction coefficient $\beta_0$
\item hydrostatic normal stress at the ice-ocean interface for floating ice, with constant sea level
\item The unperturbed domain is the infinite strip $\{(x,y,z)\in\mathbb{R}\times\mathbb{R}\times[0,H]\}$ for a
constant ice thickness $H$
\item We assume that the solutions are small perturbations of an equilibrium state
that is a constant flow in the $x$ direction, with flow velocity $u_0\geq 0$
In the case $u_0>0$, we require that $\beta=0$
\end{itemize}

\subsection*{Parameters of interest}
We consider the following model inputs/parameters:
\begin{itemize}
\item basal vertical velocity anomaly $w_b$ (i.e. from subglacial lake or bed bump)
\item basal slipperiness anomaly $\beta$
\item basal melting/freezing rate anomaly $m$, in the case of floating ice
\end{itemize}

\subsection*{Small-perturbation equations}
The goal is to solve for the perturbation in ice-surface elevation, $h$.
For floating ice, we will also need to solve for the perturbation
in ice-water elevation, $s$. \\ \\
A derivation of the evolution equations below is provided in the appendix.
\\ \\
The solution method relies on the 2D Fourier transform, which for a function $f$
is given by
\begin{align}
\hat{f}(k_x,k_y)  = \int_{-\infty}^{+\infty}\int_{-\infty}^{+\infty} f(x,y)e^{-i(k_x x + k_y y)} \; \mathrm{d}x\,\mathrm{d}y,
\end{align}
where $k_x$ and $k_y$ are wavenumbers.
The inverse Fourier transform is given by
\begin{align}
{f}(x,y) = \frac{1}{4\pi^2}\int_{-\infty}^{+\infty}\int_{-\infty}^{+\infty} \hat{f}(k_x,k_y)e^{i(k_x x + k_y y)} \; \mathrm{d}k_x \, \mathrm{d}k_y.
\end{align}
\textbf{Grounded ice.} The Fourier transformed evolution equation for grounded ice is
\begin{align}
\frac{\partial \hat{h}}{\partial t}+ \left[ik_xu_0  + \mathcal{R}_g\right]\hat{h} = \mathcal{T}_w\hat{w}_b+ik_xu_0\mathcal{T}_{\beta} \hat{\beta}.
\end{align}
The relaxation frequency $\mathcal{R}_g$ for grounded ice is given by
\begin{align}
\mathcal{R}_g = \left(\frac{\rho_i g }{2\eta k}\right)\frac{ (1+\gamma)e^{4\nu} -(2+4\gamma\nu)e^{2\nu} +1-\gamma  }{ (1+\gamma)e^{4\nu} + (2\gamma+4\nu+4\gamma\nu^2)e^{2\nu} -1 + \gamma  },
\end{align}
where $\nu = kH$, $k=\sqrt{k_x^2+k_y^2}$, and $\gamma = \beta_0/(2\eta k)$.
The learned reader will recognize $\frac{\rho_i g }{2\eta k}$ from Turcotte and Schubert's \emph{Geodynamics} text.
The velocity anomaly transfer function $\mathcal{T}_w$ is given by
\begin{align}
\mathcal{T}_w = \frac{2(1+\gamma)(\nu+1)e^{3\nu}+2(1-\gamma)(\nu-1)e^{\nu}  }{(1+\gamma)e^{4\nu} + (2\gamma+4\nu+4\gamma\nu^2)e^{2\nu} -1 + \gamma },
\end{align}
and the friction perturbation transfer function is given by
\begin{align}
\mathcal{T}_{\beta} =  \left(\frac{\nu}{\eta k^2}\right) \frac{e^{3\nu} + e^{\nu}}{e^{4\nu} +4\nu e^{2\nu} -1 }
\end{align}
where we have assumed $\gamma=\beta_0=0$  since $u_0>0$ (otherwise the term vanishes).
\\ \\
\textbf{Floating ice.} Here, the evolution of the lower surface
is also part of the solution.
The Fourier transformed elevations evolve as
\begin{align}
&\frac{\partial \hat{h}}{\partial t}+ \left[ik_xu_0  + \mathcal{R}_f\right]\hat{h} = -\delta\mathcal{B}\hat{s}\label{hf}\\
&\frac{\partial \hat{s}}{\partial t}+ [ik_xu_0 + \delta\mathcal{R}_f]\hat{s} = \hat{m} - \mathcal{B} \hat{h}, \label{sf}
\end{align}
where
\begin{align}
\mathcal{R}_f = \left(\frac{\rho_i g}{2\eta k}\right) \frac{e^{4\nu} +4\nu e^{2\nu} -1 }{e^{4\nu} -2(1+2\nu^2)e^{2\nu} +1}
\end{align}
is the relaxation function for floating ice and
\begin{align}
\mathcal{B} = \left(\frac{\rho_i g}{2\eta k}\right) \frac{ 2(\nu+1)e^{3\nu}+2(\nu-1)e^{\nu} }{e^{4\nu} -2(1+2\nu^2)e^{2\nu} +1}
\end{align}
is a buoyancy transfer function. Note that we have assumed $\gamma=\beta_0=0$ here.
It is interesting to note that the relaxation functions for grounded and floating
ice are not the same.

\section*{Scaling}
\textbf{Grounded ice:}
We let $h_0$ be a measure of the elevation anomaly magnitude and
$t_0$ a measure of the observational timescale (e.g., lake oscillation period).
We introduce the following scaling and definitions
\begin{align}
& h = h_0 h', \;\;\;\; s = h_0 s',\;\;\;\; w_b = w_0 w_{b} , \;\; w_0 = h_0 t_0^{-1} \\
& m = w_0 m',\;\;\;\; x = Hx', \;\;\;\;
t = t_p t', \;\;\;\;\\
& k' = \nu = kH , \;\;\;\; k_x' = k_x H,\;\;\;\; k_y' = k_y H
\end{align}
We scale the relaxation function as
\begin{align}
   &\mathcal{R}_g = t_r^{-1} \mathcal{R}', \;\;\;\;
 \mathcal{R}_g' =  \frac{2\pi}{\nu}\frac{ (1+\gamma)e^{4\nu} -(2+4\gamma\nu)e^{2\nu} +1-\gamma  }{ (1+\gamma)e^{4\nu} + (2\gamma+4\nu+4\gamma\nu^2)e^{2\nu} -1 + \gamma  }
\end{align}
where
\begin{align}
t_r \equiv \frac{4\pi\eta}{\rho_i g H}
\end{align}
is the characteristic relaxation time for perturbations with wavelength equal to the ice thickness $H$.
The background friction-viscosity ratio $\gamma=\beta/(2\eta k)$ can be written as
\begin{align}
   &\gamma = \beta_0' \nu^{-1}, \;\;\;\; \beta_0' = \frac{\beta_0 H}{2\eta}.
\end{align}
Similarly, we scale the friction perturbation as
\begin{align}
\beta' = \frac{ \beta H}{2\eta},
\end{align}
and define the scaled friction transfer function to be
\begin{align}
\mathcal{T}_{\beta}' =  \frac{H}{h_0}\frac{2}{\nu}\frac{e^{3\nu} + e^{\nu}}{e^{4\nu} +4\nu e^{2\nu} -1 }
\end{align}
Note that $\mathcal{T}_w$ is already nondimensional, depending only on $k' = \nu$.
\\
Dropping primes, we can rewrite the system as
\begin{align}
\frac{\partial \hat{h}}{\partial t} +\left[ik_x \bar{u} + \lambda\mathcal{R}_g \right]\hat{h} = \mathcal{T}_w\hat{w}_b +  {ik_x\bar{u}} \mathcal{T}_{\beta}\hat{\beta}, \label{dhhatsc}
\end{align}
where
\begin{align}
  \lambda \equiv  \frac{t_0}{t_r}
\end{align}
is the observational timescale relative to the relaxation time,
\begin{align}
\bar{u} \equiv \frac{u_0 t_0}{H} = \left(\frac{u_0}{H}\right) / \left(\frac{w_0}{h_0}\right)
\end{align}
is the strain rate scale from the background flow relative to the strain rate
scale from the basal anomaly.
\\ \\
\textbf{Floating ice:}
As with the grounded ice, we scale the relaxation function for floating ice as
\begin{align}
   &\mathcal{R}_f = t_r^{-1} \mathcal{R}'_f, \;\;\;\;
 \mathcal{R}'(\nu) =  \frac{2\pi}{\nu}\frac{e^{4\nu} +4\nu e^{2\nu} -1 }{e^{4\nu} -2(1+2\nu^2)e^{2\nu} +1}.
\end{align}
Similarly, we scale the buoyancy transfer function as
\begin{align}
   &\mathcal{B} =  t_r^{-1} \mathcal{B}', \;\;\;\;
 \mathcal{B}'(\nu) =   \frac{2\pi}{\nu}\frac{ 2(\nu+1)e^{3\nu}+2(\nu-1)e^{\nu} }{e^{4\nu} -2(1+2\nu^2)e^{2\nu} +1}.
\end{align}
Dropping primes, the free surface equations become
\begin{align}
\frac{\partial \hat{h}}{\partial t}+ \left[ik_x \bar{u}  + \lambda \mathcal{R}_f\right]\hat{h} = -\lambda \delta\mathcal{B}\hat{s}\\
\frac{\partial \hat{s}}{\partial t}+ [ik_x\bar{u}  + \lambda\delta \mathcal{R}_f]\hat{s} = \hat{m} - \lambda \mathcal{B} \hat{h}.
\end{align}

\section*{General solutions}
\subsection*{Grounded ice}
Assuming zero initial displacement, the solution for the transformed elevation anomaly is
\begin{align}
\hat{h} = (\mathcal{T}_w\hat{w}_b + ik_x\bar{u}\mathcal{T}_{\beta}\hat{\beta}  )* \mathcal{K}_g \label{hath0}
\end{align}
where $*$ denotes convolution with respect to time $t$ and
the flow/relaxation kernel $\mathcal{K}_g$ for grounded ice is
\begin{align}
\mathcal{K}_g(t) &= e^{-[ik_x\bar{u}+\lambda \mathcal{R}_g]t}
\end{align}
with modulus $|\mathcal{K}_g| = e^{-\lambda\mathcal{R}_gt}$.
The solution is then obtained with the inverse Fourier transform.

\subsection*{Floating ice}
The surface elevation solution to (\ref{hf})-(\ref{sf}) is
\begin{align}
\hat{h} &= -\hat{m} * \mathcal{K}_f \\
\mathcal{K}_f(t)  &= \frac{2\delta\lambda\mathcal{B}}{\mu} e^{-\left(ik_x\bar{u}+\frac{\delta+1}{2}\lambda\mathcal{R}_f\right)t}\sinh\left({\frac{\mu}{2}t}\right)    \\
\mu &= \sqrt{4\delta(\lambda\mathcal{B})^2 + (\delta-1)^2(\lambda\mathcal{R}_f)^2 }
\end{align}
\begin{proof}
We define
\begin{align}
&\pmb{y} = \begin{bmatrix}
\hat{h} \\
\hat{s}
\end{bmatrix}, \;\;\;\;
\pmb{b} =
\begin{bmatrix}
0\\
\hat{m}
\end{bmatrix}\\
&\mathsf{A} = \begin{bmatrix}
-(ik_x \bar{u}  + \lambda \mathcal{R}_f) & -\delta\lambda\mathcal{B} \\
-\lambda\mathcal{B} & -(ik_x \bar{u}  + \delta\lambda\mathcal{R}_f) \\
\end{bmatrix} \equiv
\begin{bmatrix}
a+b & \delta c \\
c & a+\delta b
\end{bmatrix}
\end{align}
The system (\ref{hf})-(\ref{sf}) can be written as
\begin{align}
\dot{\pmb{y}} = \mathsf{A}\pmb{y} + \pmb{b}.
\end{align}
The matrix $\mathsf{A}$ can be diagonalized as
\begin{align}
\mathsf{A} &= \mathsf{P}\mathsf{D}\mathsf{P}^{-1},\\
\mathsf{P} &= \begin{bmatrix}
\frac{b(1-\delta)-\mu}{2c} & \frac{b(1-\delta)+\mu}{2c} \\
1 & 1
\end{bmatrix},\\
\mathsf{P}^{-1} &= \frac{1}{2\mu}\begin{bmatrix}
-2c &  \mu+(1-\delta)b \\
2c &  \mu-(1-\delta)b
\end{bmatrix},\\
\mu &= \sqrt{4c^2 \delta + b^2(\delta-1)^2}\\
\mathsf{D} &= \begin{bmatrix}
\Lambda_-  & 0 \\
0 & \Lambda_+
\end{bmatrix} \\
\Lambda_\pm &= a+\frac{\delta+1}{2}b \pm \frac{\mu}{2}
\end{align}
The matrix exponential $e^{\mathsf{A}t}$ is
\begin{align}
e^{\mathsf{A}t} = \mathsf{P}e^{\mathsf{D}t}\mathsf{P}^{-1}.
\end{align}
Luckily we only need to compute the $(1,2)$-component:
Assuming zero initial displacement, the full solution can be computed as
\begin{align}
\pmb{y}(t) = \int_0^t e^{\mathsf{A}(t-\tau)} \pmb{b}(\tau)\;\mathrm{d}\tau. \label{ysol}
\end{align}
So the surface component is
\begin{align}
\hat{h}=\int_0^t \frac{c\delta}{\mu}(e^{\Lambda_+ (t-\tau)}-e^{\Lambda_-(t-\tau)})\hat{m}(\tau)\;\mathrm{d}\tau.
\end{align}
Writing everything out...
\begin{align}
\hat{h} &= -\hat{m} * \mathcal{K}_f \\
\mathcal{K}_f(t)  &= \frac{2\delta\lambda\mathcal{B}}{\mu} e^{-\left(ik_x\bar{u}+\frac{\delta+1}{2}\lambda\mathcal{R}_f\right)t}\sinh\left({\frac{\mu}{2}t}\right)   \\
\mu &= \sqrt{4\delta(\lambda\mathcal{B})^2 + (\delta-1)^2(\lambda\mathcal{R}_f)^2 }
\end{align}
\end{proof}


% The general solution is then obtained as the inverse Fourier transform of (\ref{hath0}).
%
\section*{Inverse problem}
For all of the above problems, the solution operator $\mathsf{S}$ that maps the model
parameter $f$ (either $w_b$, $\beta$, or $m$) to the data $h$ takes the form
\begin{align}
\mathsf{S}(f) = \mathsf{F}^{-1} \left( \mathcal{K}* \mathsf{F}(f)\right)
\end{align}
where $\mathsf{F}$ is the Fourier transform and $\mathcal{K}$ is the appropriate kernel (derived above).
The least-squares solution is found by minimizing the functional
\begin{align}
\mathsf{J}(f) = \langle \mathsf{S}(f) - h^{\mathrm{obs}} ,\mathsf{S}(f) - h^{\mathrm{obs}} \rangle + \mathsf{R}(f) \label{lsq}
\end{align}
where $\mathsf{R}$ is a regularization functional.
We use the inner product
\begin{align}
\langle f,g\rangle = \int_0^T \int_{-\infty}^{+\infty} \int_{-\infty}^{+\infty} fg \;\mathrm{d}x\,\mathrm{d}y\,\mathrm{d}t,
\end{align}
which is associated with the norm
\begin{align}
\| f \| = \sqrt{\langle f,f\rangle}.
\end{align}
The adjoint of $\mathsf{S}$, i.e. the operator $\mathsf{S}^\dagger$  satisfying
$\langle \mathsf{S}(f_1),f_2 \rangle = \langle f_1, \mathsf{S}^\dagger(f_2)
\rangle$, is
\begin{align}
\mathsf{S}^\dagger (f) = \mathsf{F}^{-1} \left( \mathcal{K}_0 \star \mathsf{F}(f)\right),
\end{align}
where $\star$ denotes the cross-correlation operator.
This can be proven by noting that $\mathsf{F}$ is the adjoint of $\mathsf{F}^{-1}$ (w.r.t. the $x$ and $y$ integrals)
and $\star$ is the adjoint of $*$ (w.r.t. the $t$ integral).\\ \\
Supposing that the first variation of (\ref{lsq}) vanishes, we obtain the
(infinite-dimensional) normal equations
\begin{align}
\mathsf{S}^\dagger (\mathsf{S}(f)) + \mathsf{R}'(f) = \mathsf{S}^\dagger (h^{\mathrm{obs}}), \label{normal}
\end{align}
where $\mathsf{R}'$ denotes the variational derivative of $\mathsf{R}$.
Provided that $\mathsf{R}'$ is linear in $f$, we can solve (\ref{normal})
with the conjugate gradient method.


\newpage

\section*{Appendix: Model derivation}
The assumptions are stated at the beginning of the document.
\noindent\textbf{Body equations.}\\
Linear stokes flow:
\begin{align}
&-p_x + \eta ( u_{xx} +u_{yy} + u_{zz}) = 0  \\
&-p_y + \eta ( v_{xx}+v_{yy} + v_{zz}) = 0 \\
&-p_z + \eta ( w_{xx} +w_{yy} + w_{zz}) = \rho g \\
&u_x + v_y + w_z = 0
\end{align}
\\
\noindent\textbf{Upper surface BC ($z=h$).}\\
Stress-free conditions:
\begin{align}
&2\eta w_z - p = 0 \\
&\eta(u_z +w_x) = 0 \\
&\eta(v_z +w_y) = 0 \\
\end{align}
Kinematic equation:
\begin{align}
h_t + uh_x + vh_y = w
\end{align}

\noindent\textbf{Lower surface BC ($z=s$).}\\
\textbf{Grounded ice:}
Prescribed vertical velocity and a linear sliding law:
\begin{align}
&w  = w_b\\
&\eta(u_z + w_x) = \beta u \label{sl1} \\
&\eta(v_z + w_y) = \beta v \label{sl2}
\end{align}
\textbf{Floating ice:}
Hydrostatic normal stress
\begin{align}
&p-2\eta w_z  = \rho_w g(\ell-s)
\end{align}
where $\ell$ is sea level. A vanishing shear stress condition is assumed,
which is equivalent to setting $\beta=0$ in (\ref{sl1})-(\ref{sl2}).
\noindent Kinematic equation:
\begin{align}
s_t + us_x + vs_y  = w + m
\end{align}
where $m$ is the melt rate.\\ \\
\noindent\textbf{Equilibrium solution:}\\
We assume the equilibrium solution is either cryostatic or plug flow in the $x$ direction.
Therefore, we choose $h^0=H$ and $s^0=0$ constant, $\ell=(\rho/\rho_w)H$, and...
\begin{align}
&u^0 = u_0\geq 0\;\;\;\; \text{(constant)} \\
& v^0 = 0 \\
&w^0 = 0 \;\;\;\; (w_b^0=0)\\
&p^0 = \rho g (H-z) \\
& m^0 = 0\\
&\beta^0  = \begin{cases}
\beta_0 = 0 & \text{if} \;\; u_0>0 \\
\beta_0 \geq 0 & \text{if} \;\; u_0 =0
\end{cases}
\end{align}


\noindent\textbf{Perturbations:}\\
We introduce perturbations to the equilibrium state via
\begin{align}
&u= u^0 +  u^1 \\
&v= v^0 +  v^1 \\
&\beta = \beta^0 + \beta^1 \\
&w =  w^0 + w^1 \;\; (w_b=w_b^0 + w_b^1)\\
&p = p^0 +  p^1\\
&s =  s^0 + s^1 \\
&h = H +  h^1 \\
&m = m^0 + m^1
\end{align}
where the perturbations are small ($O(\epsilon)$ where $\epsilon \ll 1$). \\ \\
\noindent\textbf{Perturbed equations:}\\
Method: insert perturbations and discard product terms (i.e., $a^1b^1=O(\epsilon^2)$).\\
Body equations become:
\begin{align}
&-p_x^1 + \eta (u_{xx}^1 +u_{yy}^1+ u_{zz}^1) = 0 \\
&-p_x^1 + \eta (v_{xx}^1 +v_{yy}^1+ v_{zz}^1) = 0 \\
&-p_z^1 + \eta (w_{xx}^1 +w_{yy}^1+ w_{zz}^1) = 0\\
&u_x^1 + u_y^1 + w_z^1 = 0
\end{align}
Surface kinematic equations become:
\begin{align}
&h_t^1 + u_0 h_x^1  = w^1 \label{ht} \\
&s_t^1  + u_0 s_x^1 = w^1 + m^1 \label{st}
\end{align}
We have to linearize the upper and lower surface equations at $z=H +  h^1$
and $z= s^1$ onto $z=H$ and $z=0$.
\\ \\
To do this, we
use the $1^\mathrm{st}$-order Taylor expansion in depth for a function $f(z)$:
$$ f(z^0 + z^1) \approx f(z^0) + f'(z^0)z^1. $$
\\
The stress-free condition at $z=H+h^1$ is approximated at $z=H$ by
\begin{align}
&2\eta w_z^1 - p^1 = -\rho g h^1 \label{pnorm} \\
&\eta(u_z^1 +w_x^1) = 0 \\
&\eta(v_z^1 +w_y^1) = 0
\end{align}
Equation (\ref{pnorm}) states that the perturbed normal stress is balanced
by the perturbed cryostatic stress from the elevation anomaly.
\\ \\
BC's at the lower boundary ($z=0$) become:\\
\textbf{Grounded ice:}
\begin{align}
&w^1  = w_b^1\\
&\eta(u_z^1 + w_x^1) = \beta_0 u^1 + u_0\beta^1 \\
&\eta(v_z^1 +w_y^1) = \beta_0 v^1
\end{align}
\textbf{Floating ice:}
The hydrostatic condition becomes
\begin{align}
2\eta w_z^1 - p^1 = \Delta\rho g s^1
\end{align}
where $\Delta\rho = \rho_w-\rho_i$
We drop the superscripts below. \\ \\
\\ \section*{Fourier transform approach}
\subsection*{Grounded ice}
We start with the grounded ice because it is simpler.
Derivatives transform as:
\begin{align}
&\hat{f_x} = ik_x\hat{f} \\
&\hat{f_y} = ik_y\hat{f} \\
&\hat{f_{xx}} + \hat{f_{yy}} = -k^2 \hat{f}, \\ &k^2 \equiv k_x^2 + k_y^2.
\end{align}
The upper and lower surface kinematic equations (\ref{ht})-(\ref{st}) transform to
\begin{align}
\hat{h}_t + u_0 ik_x \hat{h} = \hat{w}\label{hthat}\\
\hat{s}_t + u_0 ik_x \hat{s} = \hat{w}.\label{sthat}
\end{align}
The Stokes flow equation become
\begin{align}
&-ik_x\hat{p} + \eta ( -k^2\hat{u} + \hat{u}_{zz}) = 0 \\
&-ik_y\hat{p} + \eta ( -k^2\hat{v} + \hat{v}_{zz}) = 0 \\
&-\hat{p}_z + \eta (-k^2\hat{w} + \hat{w}_{zz}) = 0 \\
&ik_x\hat{u} + ik_y\hat{v} + \hat{w}_z = 0
\end{align}
This can be reduced to a fourth-order equation for the transformed vertical velocity:
\begin{equation}
\hat{w}_{zzzz} - 2k^2 \hat{w}_{zz} + k^4 \hat{w}=0. \label{ode}
\end{equation}
The general solution to (\ref{ode}) is
\begin{align}
\hat{w} = \frac{A}{k}e^{k z} + \frac{B}{k}e^{-k z} + {C}ze^{k z}+ {D}ze^{-k z},
\end{align}
where $A,B,C,$ and $D$ depend on $k$.\\ \\
To determine the coefficients, we rewrite all the BC's in terms of $\hat{w}$ and its $z$ derivatives.
The $z$-derivatives of $\hat{w}$ are:
\begin{align}
&\hat{w}_{z} = {A}e^{k z} - {B}e^{-k z} + {C}e^{k z} + {C}kze^{k z} - {D}kze^{-k z} + {D}e^{-k z} \\
&\hat{w}_{zz} = {Ak}e^{k z} + {Bk}e^{-k z} + {2Ck}e^{k z} + {C}k^2 ze^{k z} + {D}k^2ze^{-k z} - {2Dk}e^{-k z} \\
&\hat{w}_{zzz} = {Ak^2}e^{k z} - {Bk^2}e^{-k z} + {3Ck^2}e^{k z} + {C}k^3 ze^{k z} - {D}k^3ze^{-k z} + {3Dk^2}e^{-k z}
\end{align}
The sliding law becomes
\begin{align}
&\eta( \hat{u}_z + ik_x \hat{w}) = \beta_0\hat{u} + u_0\hat{\beta} \\
&\eta( \hat{v}_z + ik_y \hat{w}) = \beta_0\hat{v}.
\end{align}
Multiplying through by $-ik_x$ and $-ik_y$, summing the equations, and using the transformed incompressibility
condition reduces this to
\begin{align}
\eta(\hat{w}_{zz} + k^2 \hat{w}) = \beta_0 \hat{w}_z - ik_x   u_0\hat{\beta}.
\end{align}
Similarly, the shear stress condition at the upper surface becomes
\begin{align}
\eta(\hat{w}_{zz} + k^2 \hat{w}) =  0.
\end{align}
The normal stress condition at the upper surface transforms to
$
2\eta \hat{w}_{z} - \hat{p} = -\rho g \hat{h}.
$
From the body equations, we can show that
$-k^2 \hat{p} = \eta(k^2\hat{w}_z - \hat{w}_{zzz}) $, which reduces this to
\begin{align}
\eta (3k^2 \hat{w}_{z}-\hat{w}_{zzz})  = -k^2 \rho g \hat{h}.
\end{align}
To simplify notation, we define the `aspect ratio' $\nu(k) = kH$.\\ \\
The upper surface normal stress BC becomes:
\begin{align}
{A} e^{\nu} - {B} e^{-\nu} + {C}\nu e^{\nu} - {D}\nu e^{-\nu}
=- \frac{\rho g }{2\eta }\hat{h} \label{b1}
\end{align}
The upper surface shear-stress BC becomes:
\begin{align}
A e^{\nu} + B e^{-\nu} + C(\nu+1) e^{\nu} +D(\nu-1) e^{-\nu} =  0
\end{align}
The sliding law BC becomes:
\begin{align}
{A(1-\gamma)} + {B(1+\gamma)} + {C(1-\gamma)}  - {D(1+\gamma)} = -\frac{ ik_x }{2\eta k}u_0\hat{\beta}
\end{align}
where we have defined $\gamma(k) = \beta_0/(2\eta k)$. \\
\\ The basal velocity anomaly BC becomes
\begin{align}
{A} + {B}  = k\hat{w}_b \label{b4}
\end{align}
Equations (\ref{b1})-(\ref{b4}) lead to a linear system
...which we solve with SymPy.\\ \\
We can write the anomaly at the surface as
\begin{align}
\hat{w}|_{z=H} &= \frac{1}{k}\left(e^{\nu} A + { e^{-\nu}}B + \nu e^{\nu} C + {\nu}{ e^{-\nu}} D\right) \\
&= -\mathcal{R}_g\hat{h} + \mathcal{T}_w\hat{w}_b  +ik_x u_0  \mathcal{T}_{\beta}  \hat{\beta}\label{wRT}
\end{align}
According to SymPy, the relaxation frequency $\mathcal{R}_g$ for grounded ice is given by
\begin{align}
\mathcal{R}_g = \left(\frac{\rho_i g }{2\eta k}\right)\frac{ (1+\gamma)e^{4\nu} -(2+4\gamma\nu)e^{2\nu} +1-\gamma  }{ (1+\gamma)e^{4\nu} + (2\gamma+4\nu+4\gamma\nu^2)e^{2\nu} -1 + \gamma  },
\end{align}
and velocity anomaly transfer function $\mathcal{T}_w$ is given by
\begin{align}
\mathcal{T}_w = \frac{2(1+\gamma)(\nu+1)e^{3\nu}+2(1-\gamma)(\nu-1)e^{\nu}  }{(1+\gamma)e^{4\nu} + (2\gamma+4\nu+4\gamma\nu^2)e^{2\nu} -1 + \gamma },
\end{align}
and the friction perturbation transfer function is given by
\begin{align}
\mathcal{T}_{\beta} =  \left(\frac{\nu}{\eta k^2}\right) \frac{e^{3\nu} + e^{\nu}}{e^{4\nu} +4\nu e^{2\nu} -1 }
\end{align}
where we have assumed $\gamma=0$  since $u_0>0$ (otherwise the term vanishes).
In frequency space,
equations (\ref{wRT}) and (\ref{hthat}) lead to the evolution equation
\begin{align}
\frac{\partial \hat{h}}{\partial t}+ \left[ik_xu_0  + \mathcal{R}_g\right]\hat{h} = \mathcal{T}_w\hat{w}_b+ik_xu_0\mathcal{T}_{\beta} \hat{\beta}. \label{dhhat}
\end{align}

\subsection*{Floating ice}
Here we assume that $\beta=0$.
The main differences here are the hydrostatic lower boundary condition
and that the lower surface evolution is also part of the solution (rather than prescribed).
Analogous to above, the hydrostatic condition becomes
\begin{align}
\eta (3k^2 \hat{w}_{z}-\hat{w}_{zzz})  = k^2 \Delta\rho g \hat{s}. \label{b4alt}
\end{align}
Upon substituting the definition of $\hat{w}$, this reduces to
\begin{align}
A-B = \frac{\Delta \rho g}{2\eta}\hat{s},
\end{align}
which replaces equation (\ref{b4}).
Following the same approach as before, the velocity at the upper surface is then given by
\begin{align}
w|_{z=H} =  -\mathcal{R}_f\hat{h} - \delta\mathcal{B}\hat{s}
\end{align}
where the relaxation function for floating ice is given by
\begin{align}
\mathcal{R}_f = \left(\frac{\rho_i g}{2\eta k}\right) \frac{e^{4\nu} +4\nu e^{2\nu} -1 }{e^{4\nu} -2(1+2\nu^2)e^{2\nu} +1}
\end{align}
The buoyancy transfer function is given by
\begin{align}
\mathcal{B} = \left(\frac{\rho_i g}{2\eta k}\right) \frac{ 2(\nu+1)e^{3\nu}+2(\nu-1)e^{\nu} }{e^{4\nu} -2(1+2\nu^2)e^{2\nu} +1}
\end{align}
and $\delta = \rho_w/\rho_i -1$.
The upper surface therefore evolves as
\begin{align}
\frac{\partial \hat{h}}{\partial t}+ \left[ik_xu_0  + \mathcal{R}_f\right]\hat{h} = -\delta\mathcal{B}\hat{s}.
\end{align}
We also have to determine the evolution of the lower surface, which evolves in frequency space as
\begin{align}
\frac{\partial \hat{s}}{\partial t}+ ik_xu_0 \hat{s} = \hat{m} + \hat{w}. \label{stfreq}
\end{align}
Using $\hat{w}|_{z=0}= \frac{1}{k}(A+B)$, we can find
\begin{align}
\hat{w}|_{z=0} = -\delta\mathcal{R}_f\hat{s} - \mathcal{B} \hat{h}.
\end{align}
Therefore, (\ref{stfreq}) becomes
\begin{align}
\frac{\partial \hat{s}}{\partial t}+ [ik_xu_0 + \delta\mathcal{R}_f]\hat{s} = \hat{m} - \mathcal{B} \hat{h}.
\end{align}

\end{document}
