\documentclass[paper=a4, fontsize=11pt]{article}
\usepackage{amsmath,amsfonts}
\usepackage{amsthm}
\usepackage[ruled,vlined]{algorithm2e}

\title{
Inversion of altimetry time series for basal perturbations: theory
and synthetic experiments
}

\author{Aaron Stubblefield (Columbia University)} % Your name

\date{\small\today} % Today's date or a custom date

\begin{document}

\maketitle % Print the title

\section*{Overview}
\subsection*{Scope}
Inverting altimetry data for basal properties with linearized Stokes models.
Also analyzing the behavior of these models.

\subsection*{Assumptions}
\begin{itemize}
\item Newtonian viscosity $\eta$
\item linear sliding law at the base for grounded ice, with friction coefficient $\beta_0$
\item hydrostatic normal stress at the ice-ocean interface for floating ice
\item The unperturbed domain is the infinite strip $\{(x,y,z)\in\mathbb{R}\times\mathbb{R}\times[0,H]\}$ for a
constant ice thickness $H$
\item We assume that the solutions are small perturbations of an equilibrium state
that is a uniform flow in the $x$ direction, with flow velocity $u_0\geq 0$.
In the case $u_0>0$, we require that $\beta_0=0$.
\end{itemize}

\subsection*{Parameters of interest}
We consider the following model inputs/parameters:
\begin{itemize}
\item basal vertical velocity anomaly $w_b$ (i.e. from subglacial lake or bed bump)
\item basal slipperiness anomaly $\beta$
\item basal melting/freezing rate anomaly $m$, in the case of floating ice
\end{itemize}

\section*{Small-perturbation equations}
The goal is to solve for the perturbation in ice-surface elevation, $h$.
For floating ice, we will also need to solve for the perturbation
in ice-water elevation, $s$. \\ \\
A derivation of the evolution equations is provided in the appendix.
\\ \\
The solution method relies on the 2D Fourier transform, which for a function $f$
is given by
\begin{align}
\widehat{f}(k_x,k_y)  = \int_{-\infty}^{+\infty}\int_{-\infty}^{+\infty} f(x,y)e^{-i(k_x x + k_y y)} \; \mathrm{d}x\,\mathrm{d}y,
\end{align}
where $k_x$ and $k_y$ are wavenumbers. We denote the modulus of the wavevector by
\begin{align}
k = \sqrt{k_x^2 + k_y^2}.
\end{align}
The inverse Fourier transform is given by
\begin{align}
{f}(x,y) = \frac{1}{4\pi^2}\int_{-\infty}^{+\infty}\int_{-\infty}^{+\infty} \widehat{f}(k_x,k_y)e^{i(k_x x + k_y y)} \; \mathrm{d}k_x \, \mathrm{d}k_y.
\end{align}
We will also denote the Fourier transform operator and its inverse by $\mathsf{F}$ and
$\mathsf{F}^{-1}$, respectively.
\\ \\
We will also rely on the convolution operation with respect to time $t$:
\begin{align}
f*g = \int_0^t f(\tau)g(t-\tau)\;\mathrm{d}\tau,
\end{align}
which is the same as the usual definition $f*g = \int_{-\infty}^{+\infty} f(\tau)g(t-\tau)\;\mathrm{d}\tau$
when $f$ and $g$ are zero for $t<0$.
\\ \\
\textbf{Grounded ice.} Fourier-transformed evolution equation for grounded ice is
\begin{align}
\frac{\partial \widehat{h}}{\partial t}+ \left[ik_xu_0  + \mathcal{R}_g\right]\widehat{h} = \mathcal{T}_w\widehat{w}_b+ik_xu_0\mathcal{T}_{\beta} \widehat{\beta}.
\end{align}
The relaxation frequency $\mathcal{R}_g$ for grounded ice is given by
\begin{align}
\mathcal{R}_g = \left(\frac{\rho_i g }{2\eta k}\right)\frac{ (1+\gamma)e^{4\nu} -(2+4\gamma\nu)e^{2\nu} +1-\gamma  }{ (1+\gamma)e^{4\nu} + (2\gamma+4\nu+4\gamma\nu^2)e^{2\nu} -1 + \gamma  },
\end{align}
where $\nu = kH$, $k=\sqrt{k_x^2+k_y^2}$, and $\gamma = \beta_0/(2\eta k)$.
The learned reader will recognize $\frac{\rho_i g }{2\eta k}$ from Turcotte and Schubert's \emph{Geodynamics} text.
The velocity anomaly transfer function $\mathcal{T}_w$ is given by
\begin{align}
\mathcal{T}_w = \frac{2(1+\gamma)(\nu+1)e^{3\nu}+2(1-\gamma)(\nu-1)e^{\nu}  }{(1+\gamma)e^{4\nu} + (2\gamma+4\nu+4\gamma\nu^2)e^{2\nu} -1 + \gamma },
\end{align}
and the friction perturbation transfer function is given by
\begin{align}
\mathcal{T}_{\beta} =  \left(\frac{\nu}{\eta k^2}\right) \frac{e^{3\nu} + e^{\nu}}{e^{4\nu} +4\nu e^{2\nu} -1 },
\end{align}
where we have assumed $\gamma=\beta_0=0$  since $u_0>0$ (otherwise the term vanishes).
\\ \\
\textbf{Floating ice.} Here, the evolution of the ice-water interface anomaly, $s$,
is also part of the solution.
The Fourier transformed elevations evolve as
\begin{align}
&\frac{\partial \widehat{h}}{\partial t}+ \left[ik_xu_0  + \mathcal{R}_f\right]\widehat{h} = -\delta\mathcal{B}\widehat{s}\label{hf}\\
&\frac{\partial \widehat{s}}{\partial t}+ [ik_xu_0 + \delta\mathcal{R}_f]\widehat{s} = \widehat{m} - \mathcal{B} \widehat{h}, \label{sf}
\end{align}
where $\delta = \rho_w/\rho_i -1$, the relaxation function for floating ice is
\begin{align}
\mathcal{R}_f = \left(\frac{\rho_i g}{2\eta k}\right) \frac{e^{4\nu} +4\nu e^{2\nu} -1 }{e^{4\nu} -2(1+2\nu^2)e^{2\nu} +1}, \label{Rf}
\end{align}
and
\begin{align}
\mathcal{B} = \left(\frac{\rho_i g}{2\eta k}\right) \frac{ 2(\nu+1)e^{3\nu}+2(\nu-1)e^{\nu} }{e^{4\nu} -2(1+2\nu^2)e^{2\nu} +1} \label{B}
\end{align}
is a buoyancy transfer function. Note that we have assumed $\gamma=\beta_0=0$ here.
It is interesting to note that the relaxation functions for grounded and floating
ice are not the same.

\section*{Scaling}
\textbf{Grounded ice:}
We let $h_0$ be a measure of the elevation anomaly magnitude and
$t_0$ a measure of the observational timescale (e.g., lake oscillation period).
We introduce the following scaling and definitions
\begin{align}
& h = h_0 h', \;\;\;\; w_b = w_0 w_{b}' , \;\; w_0 = h_0 t_0^{-1} \\
&  x = Hx', \;\;\;\;
t = t_p t', \;\;\;\;\\
& k' = \nu = kH , \;\;\;\; k_x' = k_x H,\;\;\;\; k_y' = k_y H
\end{align}
We scale the relaxation function as
\begin{align}
   &\mathcal{R}_g = t_r^{-1} \mathcal{R}', \;\;\;\;
 \mathcal{R}_g'(k') =  \frac{1}{k'}\frac{ (1+\gamma)e^{4k'} -(2+4\gamma k')e^{2 k'} +1-\gamma  }{ (1+\gamma)e^{4 k'} + (2\gamma+4 k'+4\gamma (k')^2)e^{2 k'} -1 + \gamma  }
\end{align}
where
\begin{align}
t_r \equiv \frac{2\eta}{\rho_i g H}
\end{align}
is the characteristic relaxation time for perturbations with $H^{-1}$ wavenumber.
The background friction-viscosity ratio $\gamma=\beta/(2\eta k)$ can be written as
\begin{align}
   &\gamma = \beta_0' (k')^{-1}, \;\;\;\; \beta_0' = \frac{\beta_0 H}{2\eta}.
\end{align}
Similarly, we scale the friction perturbation as
\begin{align}
\beta' = \frac{ \beta H}{2\eta},
\end{align}
and define the scaled friction transfer function to be
\begin{align}
\mathcal{T}_{\beta}'(k') =  \frac{2}{k'}\frac{e^{3k'} + e^{k'}}{e^{4 k'} +4 k' e^{2 k'} -1 }.
\end{align}
Note that $\mathcal{T}_w$ is already nondimensional, depending only on $k' = \nu$.
\\
Dropping primes, the non-dimensionalized equation becomes
\begin{align}
\frac{\partial \widehat{h}}{\partial t} +\left[ik_x \theta + \lambda\mathcal{R}_g \right]\widehat{h} = \mathcal{T}_w\widehat{w}_b +   {ik_x\xi}\mathcal{T}_{\beta}\widehat{\beta}, \label{dhhatsc}
\end{align}
where
\begin{align}
  \lambda \equiv  \frac{t_0}{t_r}
\end{align}
is the observational timescale relative to the relaxation time,
\begin{align}
\xi \equiv \frac{u_0 t_0}{h_0} = \frac{u_0}{w_0}
\end{align}
is the horizontal velocity relative to the vertical velocity, and
\begin{align}
\theta \equiv \frac{u_0 t_0}{H} = \left(\frac{u_0}{H}\right) / \left(\frac{w_0}{h_0}\right)
\end{align}
is the horizontal strain-rate scale from the background flow relative to the vertical strain-rate
scale from the basal anomaly.
\\ \\
\textbf{Floating ice:}
With the same definitions as in the previous section, we scale the melt rate anomaly
and lower surface elevation as
\begin{align}
m = w_0 m',\;\;\;\; s = h_0 s'.
\end{align}
As with the grounded ice, we scale the relaxation function for floating ice as
\begin{align}
   &\mathcal{R}_f(k') = t_r^{-1} \mathcal{R}'_f, \;\;\;\;
 \mathcal{R}_f'(k') =  \frac{1}{k'}\frac{e^{4k'} +4k' e^{2k'} -1 }{e^{4k'} -2(1+2(k')^2)e^{2k'} +1}. \label{Rfsc}
\end{align}
Similarly, we scale the buoyancy transfer function as
\begin{align}
   &\mathcal{B} =  t_r^{-1} \mathcal{B}', \;\;\;\;
 \mathcal{B}'(k') =   \frac{1}{k'}\frac{ 2(k'+1)e^{3k'}+2(k'-1)e^{k'} }{e^{4k'} -2(1+2(k')^2)e^{2k'} +1}. \label{Bsc}
\end{align}
Dropping primes, the non-dimensionalized free-surface equations become
\begin{align}
\frac{\partial \widehat{h}}{\partial t}+ \left[ik_x \theta  + \lambda \mathcal{R}_f\right]\widehat{h} = -\lambda \delta\mathcal{B}\widehat{s}\label{hfsc}\\
\frac{\partial \widehat{s}}{\partial t}+ [ik_x\theta  + \lambda\delta \mathcal{R}_f]\widehat{s} = \widehat{m} - \lambda \mathcal{B} \widehat{h}.\label{sfsc}
\end{align}

\section*{General solutions}
\subsection*{Grounded ice}
Assuming zero initial displacement, the solution to (\ref{dhhatsc}) for the transformed elevation anomaly is
\begin{align}
\widehat{h} = (\mathcal{T}_w\widehat{w}_b + ik_x\xi\mathcal{T}_{\beta}\widehat{\beta}  )* \mathcal{K}_g \label{hath0}
\end{align}
where $*$ denotes convolution with respect to time $t$ and
the flow/relaxation kernel $\mathcal{K}_g$ for grounded ice is
\begin{align}
\mathcal{K}_g(t) &= e^{-[ik_x\theta+\lambda \mathcal{R}_g]t}.
\end{align}
The physical-space solution is then obtained from (\ref{hath0}) with the inverse Fourier transform.
\subsubsection*{Linear stability}
One can show that the equilibrium solutions are stable attractors
(for $w_b$ and $\beta$ not varying in time), since the modulus of the kernel is
$|\mathcal{K}_g| = e^{-\lambda \mathcal{R}_gt}$.


\subsection*{Floating ice}
We define
\begin{align}
&\pmb{y} = \begin{bmatrix}
\widehat{h} \\
\widehat{s}
\end{bmatrix}, \;\;\;\;
\pmb{b} =
\begin{bmatrix}
0\\
\widehat{m}
\end{bmatrix}\\
&{A} = \begin{bmatrix}
-(ik_x \theta  + \lambda \mathcal{R}_f) & -\delta\lambda\mathcal{B} \\
-\lambda\mathcal{B} & -(ik_x \theta  + \delta\lambda\mathcal{R}_f) \\
\end{bmatrix} \equiv
\begin{bmatrix}
a+b & \delta c \\
c & a+\delta b
\end{bmatrix}
\label{Amat}
\end{align}
The system (\ref{hfsc})-(\ref{sfsc}) can be written as
\begin{align}
\dot{\pmb{y}} = {A}\pmb{y} + \pmb{b}.
\end{align}
The matrix ${A}$ can be diagonalized as
\begin{align}
{A} &= \mathsf{P}\mathsf{D}\mathsf{P}^{-1},\\
{P} &= \begin{bmatrix}
\frac{b(1-\delta)-\mu}{2c} & \frac{b(1-\delta)+\mu}{2c} \\
1 & 1
\end{bmatrix},\\
{P}^{-1} &= \frac{1}{2\mu}\begin{bmatrix}
-2c &  \mu+(1-\delta)b \\
2c &  \mu-(1-\delta)b
\end{bmatrix},\\
\mu &= \sqrt{4c^2 \delta + b^2(\delta-1)^2} = \sqrt{4\delta(\lambda\mathcal{B})^2 + (\delta-1)^2(\lambda\mathcal{R}_f)^2 } \label{mu}\\
{D} &= \begin{bmatrix}
\Lambda_-  & 0 \\
0 & \Lambda_+
\end{bmatrix} \\
\Lambda_\pm &= a+\frac{\delta+1}{2}b \pm \frac{\mu}{2} \label{Lambda}
\end{align}
The matrix exponential $e^{{A}t}$ is
\begin{align}
e^{{A}t} = {P}e^{{D}t}{P}^{-1}.
\end{align}
Luckily we only need to compute the $(1,2)$-component:
Assuming zero initial displacement, the full solution can be computed as
\begin{align}
\pmb{y}(t) = \int_0^t e^{{A}(t-\tau)} \pmb{b}(\tau)\;\mathrm{d}\tau. \label{ysol}
\end{align}
The solution for the ice-surface elevation anomaly is
\begin{align}
\widehat{h} &= \widehat{m} * \mathcal{K}_f\\
\mathcal{K}_f(t)  &=  \frac{c\delta}{\mu}(e^{\Lambda_+ t}-e^{\Lambda_-t}).
\end{align}
\subsubsection*{Linear stability}
For $m$ not varying in time, equilibrium solutions are also stable for this problem.
To see this, note that $\mathrm{Re}(\Lambda_-)<0$ follows immediately
from (\ref{Amat}), (\ref{mu}), and (\ref{Lambda}).
For the other eigenvalue, we have
\begin{align}
\mathrm{Re}(\Lambda_+) = -\frac{\delta+1}{2}\lambda\mathcal{R}_f + \frac{\mu}{2}
= \frac{\lambda}{2}\left(-(\delta+1)\mathcal{R}_f+\sqrt{4\delta\mathcal{B}^2 + (\delta-1)^2\mathcal{R}_f^2 } \,\right). \label{RLp}
\end{align}
It follows from (\ref{RLp}) that $\mathrm{Re}(\Lambda_+)<0$ if and only if
\begin{align}
&\sqrt{4\delta\mathcal{B}^2 + (\delta-1)^2\mathcal{R}_f^2 } < (\delta+1)\mathcal{R}_f \\
\iff &4\delta\mathcal{B}^2 + (\delta-1)^2\mathcal{R}_f^2 < (\delta+1)^2 \mathcal{R}_f^2 \\
\iff &4\delta\mathcal{B}^2 < 4\delta \mathcal{R}_f^2
\end{align}
Therefore, the stability criterion for a given wavevector is
\begin{align}
\mathrm{Re}(\Lambda_+)<0  \iff &\mathcal{B}(k) < \mathcal{R}_f(k), \label{stability}
\end{align}
which states that viscous relaxation must exceed the bouyancy force
in order for the equilibrium to be stable (i.e., no runaway growth). \\ \\
\textbf{From (\ref{Rfsc}) and (\ref{Bsc}),
the condition (\ref{stability}) holds for all $k>0$!}
\\ \\
Caveat: Of course, nonlinear
effects or other physics (e.g., fracture) not considered here could lead to instability.

\section*{Inverse problem}
\subsection*{Altimetry inversions}
For all of the above problems, the solution operator $\mathsf{H}_\varphi$ that maps the model
parameter $\varphi$ (either $w_b$, $\beta$, or $m$) to the data $h$ takes the form
\begin{align}
\mathsf{H}_\varphi(\varphi) = \mathsf{F}^{-1} \left( \mathcal{K}_\varphi* \mathsf{F}(\varphi)\right),
\end{align}
where $\mathsf{F}$ is the Fourier transform and the kernel for each parameter is
\begin{align}
\mathcal{K}_\varphi(t) =
\begin{cases}
\mathcal{T}\mathcal{K}_g(t) & \varphi = w_b \\
ik_x\xi\mathcal{T}_{\beta}\mathcal{K}_g(t) & \varphi = \beta \\
\mathcal{K}_f(t) & \varphi = m
\end{cases} .
\end{align}
The least-squares solution is found by minimizing the regularized misfit functional
\begin{align}
\mathsf{J}(\varphi) = \frac{1}{2}\| \mathsf{H}_\varphi(\varphi) - h^{\mathrm{obs}} \|^2 + \mathsf{R}(\varphi) \label{lsq}
\end{align}
where $\mathsf{R}$ is a regularization functional and $h^{\mathrm{obs}}$ is the altimetry data.
We use the inner product
\begin{align}
\langle f,g\rangle = \int_0^T \int_{-\infty}^{+\infty} \int_{-\infty}^{+\infty} fg \;\mathrm{d}x\,\mathrm{d}y\,\mathrm{d}t,
\end{align}
which is associated with the norm
\begin{align}
\| f \| = \sqrt{\langle f,f\rangle},
\end{align}
where $T$ is the final time.
The adjoint of $\mathsf{H}_\varphi$, i.e. the operator $\mathsf{H}_\varphi^\dagger$  satisfying
$\langle \mathsf{H}_\varphi(f_1),f_2 \rangle = \langle f_1, \mathsf{H}_\varphi^\dagger(f_2)
\rangle$ for all $f_1$ and $f_2$, is,
\begin{align}
\mathsf{H}_\varphi^\dagger (\varphi) = \mathsf{F}^{-1} \left( \mathcal{K}_\varphi \star \mathsf{F}(\varphi)\right),
\end{align}
where $\star  $ denotes the cross-correlation operator.
This can be proven by noting that ${4\pi^2}\mathsf{F}^{-1}$ is the adjoint of $\mathsf{F}$ (w.r.t. the $x$ and $y$ integrals)
and $\star$ is the adjoint of $*$ (w.r.t. the $t$ integral).
\\
{\footnotesize{\noindent
\emph{Note:} we are using a non-unitary FT definition, but the scale factors
cancel out here.}} \\ \\
Supposing that the first variation of (\ref{lsq}) vanishes, we obtain the
(infinite-dimensional) normal equations
\begin{align}
\mathsf{H}_\varphi^\dagger (\mathsf{H}_\varphi(\varphi)) + \mathsf{R}'(\varphi) = \mathsf{H}_\varphi^\dagger (h^{\mathrm{obs}}), \label{normal}
\end{align}
where $\mathsf{R}'$ denotes the variational derivative of $\mathsf{R}$.
Provided that $\mathsf{R}'$ is linear (and self-adjoint, continuous, positive-definite),
we can solve (\ref{normal})
efficiently with the conjugate gradient method (Algorithm 1).
See Atkinson and Han (2009, \S 5.6) or Hanke (2017, ch. 15) for a discussion
of the CG method applied to infinite-dimensional operator equations.
Here, we consider Tikhonov regularizations on $f$ or its spatial gradient,
\begin{align}
\mathsf{R}(f)&=\frac{\varepsilon}{2}\|f\|^2,\;\;\;\; \text{or}\\
\mathsf{R}(f)&=\frac{\varepsilon}{2}(\|f_x\|^2+\|f_y\|^2),
\end{align}
which have variational derivatives
\begin{align}
\mathsf{R}'(f) = \varepsilon f, \;\;\;\; \text{or} \\
\mathsf{R}'(f) = \varepsilon (-f_{xx}-f_{yy}),
\end{align}
respectively, where $\varepsilon$ is a regularization parameter.
The solution is obtained from Algorithm 1 with $\mathsf{A}(\cdot) = \mathsf{H}_\varphi^\dagger(\mathsf{H}_\varphi(\cdot)) + \mathsf{R}'(\cdot) $, $x=\varphi$, and $b=\mathsf{H}_\varphi^\dagger (h^{\mathrm{obs}})$.

\begin{algorithm}[H]
\SetAlgoLined
initialize maximum iteration, $j_\mathrm{max}$, and stopping tolerance, $\mathrm{tol}$\;
 $j \gets 0$\;
 $x_0 \gets 0$\;
 ${r_0} \gets b - \mathsf{A}(x_0)$\;
 $p_0 \gets r_0$\;
 \While{$\|r_j\|>\mathrm{tol}$}{
   $\alpha_j \gets \frac{\langle r_j, r_j\rangle}{ \langle p_j,\mathsf{A}(p_j) \rangle}$\;
  $x_{j+1} \gets x_j + \alpha_j p_j$\;
  $r_{j+1} \gets r_j - \alpha_j \mathsf{A}(p_j)$\;
  $\beta_j \gets \frac{\langle r_{j+1} , r_{j+1} \rangle}{\langle r_{j} , r_{j} \rangle} $\;
  $p_{j+1} \gets r_j + \beta_j p_j$\;
  \eIf{$j=j_\mathrm{max}$}{
   exit loop\;
   }{
   $j\gets j+1$\;
  }
 }
 return solution $x_j$\;
 \caption{CG method for solving $\mathsf{A}(x)=b$ }
\end{algorithm}

\subsection*{Joint velocity-altimetry inversions}
For the ice stream problem ($u_0>0$ and $\gamma=0$), equation (\ref{hath0})
shows that both $w_b$ and $\beta$ can influence the surface elevation anomaly.
Joint inversion for these parameters requires incorporation of horziontal surface
velocity data. Expressions for the surface velocity solutions are derived
in the Appendix. The (coupled) surface velocity solution operators take the form
\begin{align}
\mathsf{U}_c(w_b,\beta) =  \mathsf{F}^{-1}(\xi\mathcal{U}_{\beta} \mathsf{F}({\beta}) -ik_x\left(\lambda\mathcal{U}_h\mathsf{F}( \mathsf{H}_c(w_b,\beta) ) +  \mathcal{U}_w\mathsf{F}(w_b)\right)) \label{U}\\
\mathsf{V}_c(w_b,\beta) =  \mathsf{F}^{-1}(\xi\mathcal{V}_{\beta} \mathsf{F}({\beta}) -ik_y\left(\lambda\mathcal{V}_h\mathsf{F}( \mathsf{H}_c(w_b,\beta) ) +  \mathcal{V}_w\mathsf{F}(w_b)\right))\label{V},
\end{align}
where $\mathcal{U}_\ell$ and $\mathcal{V}_\ell$ are response functions, and
\begin{align}
\mathsf{H}_c(w_b,\beta) = \mathsf{H}_{w_b}(w_b) + \mathsf{H}_{\beta}(\beta)
\end{align}
is the (coupled) elevation solution operator.
We define the uncoupled velocity solution operators via
\begin{align}
\mathsf{U}_{w_b} (w_b) = \mathsf{U}_c(w_b,0), \;\;\;\; \mathsf{U}_{\beta} (\beta) = \mathsf{U}_c(0,\beta) \\
\mathsf{V}_{w_b} (w_b) = \mathsf{V}_c(w_b,0), \;\;\;\; \mathsf{V}_{\beta} (\beta) = \mathsf{V}_c(0,\beta),
\end{align}
which have adjoints
\begin{align}
&\mathsf{U}_{w_b}^\dagger (f) =
\mathsf{H}_{w_b}^{\dagger}(\mathsf{F}^{-1}( ik_x\lambda\mathcal{U}_h\mathsf{F}( f )))
+  \mathsf{F}^{-1}(ik_x{\mathcal{U}_w}\mathsf{F}(f)) \\
&\mathsf{V}_{w_b}^\dagger (f) =
\mathsf{H}_{w_b}^{\dagger}(\mathsf{F}^{-1}( ik_y\lambda\mathcal{V}_h\mathsf{F}( f )))
+  \mathsf{F}^{-1}(ik_y{\mathcal{V}_w}\mathsf{F}(f))\\
&\mathsf{U}_{\beta}^\dagger (f) =
\mathsf{H}_{\beta}^{\dagger}(\mathsf{F}^{-1}( ik_x\lambda\mathcal{U}_h\mathsf{F}( f )))
+  \mathsf{F}^{-1}(\xi{\mathcal{U}_\beta}\mathsf{F}(f)) \\
&\mathsf{V}_{\beta}^\dagger (f) =
\mathsf{H}_{\beta}^{\dagger}(\mathsf{F}^{-1}( ik_y\lambda\mathcal{V}_h\mathsf{F}( f )))
+  \mathsf{F}^{-1}(\xi{\mathcal{V}_\beta}\mathsf{F}(f)),
\end{align}
where we used the fact that all of the response functions $\{\mathcal{U}_\ell,\mathcal{V}_\ell\}$
are real-valued.\\ \\
We let $u^\mathrm{obs}$ and $v^\mathrm{obs}$ be the horizontal surface velocity data.
Similar to before, the least-squares solution is found by minimizing the regularized misfit functional
\begin{align}
\mathsf{J}_c(w_b,\beta)  =  \frac{1}{2}\|& \mathsf{H}_c(w_b,\beta) - h^{\mathrm{obs}} \|^2 +
 \frac{1}{2}\| \mathsf{U}_c(w_b,\beta) - u^{\mathrm{obs}} \|^2 \\ & +
  \frac{1}{2}\| \mathsf{V}_c(w_b,\beta) - v^{\mathrm{obs}} \|^2 +
\mathsf{R}_{w_b}(w_b) +\mathsf{R}_\beta(\beta) \label{lsq}
\end{align}
Supposing that the first variations with respect to $w_b$ and $\beta$ vanish,
we obtain the system

\begin{align}
\begin{cases}
\mathsf{H}_{w_b}^\dagger (\mathsf{H}_c(w_b,\beta))
+\mathsf{U}_{w_b}^\dagger (\mathsf{U}_c(w_b,\beta))
+\mathsf{V}_{w_b}^\dagger (\mathsf{V}_c(w_b,\beta))  + \mathsf{R}_{w_b}'(w_b)   \\
= \mathsf{H}_{w_b}^\dagger (h^{\mathrm{obs}}) + \mathsf{U}_{w_b}^\dagger (u^{\mathrm{obs}})
+\mathsf{V}_{w_b}^\dagger (v^{\mathrm{obs}}) \\ \\
\mathsf{H}_{\beta}^\dagger (\mathsf{H}_c(w_b,\beta))
+\mathsf{U}_{\beta}^\dagger (\mathsf{U}_c(w_b,\beta))
+\mathsf{V}_{\beta}^\dagger (\mathsf{V}_c(w_b,\beta))  + \mathsf{R}_{\beta}'(\beta)   \\
= \mathsf{H}_{\beta}^\dagger (h^{\mathrm{obs}}) + \mathsf{U}_{\beta}^\dagger (u^{\mathrm{obs}})
+\mathsf{V}_{\beta}^\dagger (v^{\mathrm{obs}})
\end{cases},
\end{align}
which we also solve with the conjugate gradient method (Algorithm 1).

\newpage
\section*{Appendix A: \emph{A priori} estimate}
Recent work has shown the difficulty of estimating subglacial-lake
volume-change (Stubblefield et al., \emph{GRL} submission) and
sub-shelf melt rates (Wearing et al., \emph{GRL} submission) from
surface elevation-change alone. The simple estimate derived here reinforces these results. \\ \\
Again, we are studying the abstract problem of inferring the parameter $f$
from elevation change $h$, which are related via
\begin{align*}
\widehat{h} = \widehat{f}*\mathcal{K}_\lambda,
\end{align*}
where we are emphasizing the dependence of the kernel $\mathcal{K}_\lambda$ on $\lambda$:\\
$|\mathcal{K}_\lambda|\to 0$ as $\lambda\to \infty$ (for all $k$) for all of the problems herein.
\\ \\
We rely on two well-known results:
\begin{enumerate}
\item \textbf{Plancherel's theorem:} $$\int_{-\infty}^{+\infty}\int_{-\infty}^{+\infty} f(x,y) \;\mathrm{d}x\,\mathrm{d}y = \frac{1}{(2\pi)^2}
\int_{-\infty}^{+\infty}\int_{-\infty}^{+\infty} \widehat{f}(k_x,k_y) \;\mathrm{d}k_x\,\mathrm{d}k_y$$
{\footnotesize{\noindent \emph{Note:} the $\frac{1}{(2\pi)^2}$ factor arises because we are using a non-unitary
Fourier transform definition.}}
\item \textbf{Young's convolution inequality:}
$$\int_0^T |f*g|^2 \;\mathrm{d}t \leq \left(\int_0^T |f|^2 \;\mathrm{d}t\right)
\left(\int_0^T |g| \;\mathrm{d}t\right)^2 $$
{\footnotesize{\noindent
\emph{Note:} typically this is stated where convolution is defined as
$f*g = \int_{-\infty}^{+\infty} f(\tau)g(t-\tau)\;\mathrm{d}\tau$, but this
is equivalent to our definition when $f$ and $g$ are zero for $t<0$.
(So just extend $f$ and $\mathcal{K}_\lambda$ by zero for $t<0$ and use the
original theorem to show this).}}
\end{enumerate}
Using the same norm as in the previous section, we can show
\begin{align*}
\|h\| = \frac{1}{2\pi}\|\widehat{h}\|
= \frac{1}{2\pi}\|\widehat{f}*\mathcal{K}_\lambda \|
\leq \frac{1}{2\pi} \|\widehat{f}\| \left(\int_{-\infty}^{+\infty}\int_{-\infty}^{+\infty}\left(\int_0^T |\mathcal{K}_\lambda| \;\mathrm{d}t\right)^2 \;\mathrm{d}k_x\,\mathrm{d}k_y \right),
\end{align*}
so that
\begin{align}
\|h\| \leq C_\lambda \|{f}\|, \label{est}
\end{align}
where
\begin{align*}
C_\lambda \equiv \left(\int_{-\infty}^{+\infty}\int_{-\infty}^{+\infty}\left(\int_0^T |\mathcal{K}_\lambda| \;\mathrm{d}t\right)^2 \;\mathrm{d}k_x\,\mathrm{d}k_y \right)\to 0 \;\; \text{as} \;\;\lambda\to\infty.
\end{align*}
The estimate (\ref{est}) shows that $\|{h}\|$ can be significantly smaller
than $\|f\|$ when $\lambda$ is large. While that was probably obvious
at this point, one could in principle calculate $C_\lambda $ numerically
to quantify this for a given set of parameters. From a writing perspective,
this section would be shortened and appear earlier for motivation if it is included.

\section*{Appendix B: Model derivation}
The assumptions are stated at the beginning of the document.\\ \\
\noindent\textbf{Body equations.}\\
Newtonian Stokes flow:
\begin{align}
&-p_x + \eta ( u_{xx} +u_{yy} + u_{zz}) = 0  \\
&-p_y + \eta ( v_{xx}+v_{yy} + v_{zz}) = 0 \\
&-p_z + \eta ( w_{xx} +w_{yy} + w_{zz}) = \rho g \\
&u_x + v_y + w_z = 0
\end{align}
\\
\noindent\textbf{Upper surface BC ($z=h$).}\\
Stress-free conditions:
\begin{align}
&2\eta w_z - p = 0 \\
&\eta(u_z +w_x) = 0 \\
&\eta(v_z +w_y) = 0
\end{align}
Kinematic equation:
\begin{align}
h_t + uh_x + vh_y = w,
\end{align}
neglecting SMB here because I don't consider accumulation/ablation perturbations below.
\\  \\
\noindent\textbf{Lower surface BC ($z=s$).}\\
\textbf{Grounded ice:}
Prescribed vertical velocity and a linear sliding law:
\begin{align}
&w  = w_b\\
&\eta(u_z + w_x) = \beta u \label{sl1} \\
&\eta(v_z + w_y) = \beta v \label{sl2}
\end{align}
\textbf{Floating ice:}
Hydrostatic normal stress
\begin{align}
&p-2\eta w_z  = \rho_w g(\ell-s)
\end{align}
where $\ell$ is sea level. A vanishing shear stress condition is assumed,
which is equivalent to setting $\beta=0$ in (\ref{sl1})-(\ref{sl2}).
\noindent Kinematic equation:
\begin{align}
s_t + us_x + vs_y  = w + m
\end{align}
where $m$ is the melt rate.\\ \\
\noindent\textbf{Equilibrium solution:}\\
We assume the equilibrium solution is either cryostatic or uniform flow in the $x$ direction.
Therefore, we choose $h^0=H$ and $s^0=0$ constant, $\ell=(\rho/\rho_w)H$, and...
\begin{align}
&u^0 = u_0\geq 0\;\;\;\; \text{(constant)} \\
& v^0 = 0 \\
&w^0 = 0 \;\;\;\; (w_b^0=0)\\
&p^0 = \rho g (H-z) \\
& m^0 = 0\\
&\beta^0  = \begin{cases}
\beta_0 = 0 & \text{if} \;\; u_0>0 \\
\beta_0 \geq 0 & \text{if} \;\; u_0 =0
\end{cases}
\end{align}


\noindent\textbf{Perturbations:}\\
We introduce perturbations to the equilibrium state via
\begin{align}
&u= u^0 +  u^1 \\
&v= v^0 +  v^1 \\
&\beta = \beta^0 + \beta^1 \\
&w =  w^0 + w^1 \;\; (w_b=w_b^0 + w_b^1)\\
&p = p^0 +  p^1\\
&s =  s^0 + s^1 \\
&h = H +  h^1 \\
&m = m^0 + m^1
\end{align}
where the perturbations are small ($O(\epsilon)$ where $\epsilon \ll 1$). \\ \\
\noindent\textbf{Perturbed equations:}\\
Method: insert perturbations and discard product terms (i.e., $a^1b^1=O(\epsilon^2)$).\\
Body equations become:
\begin{align}
&-p_x^1 + \eta (u_{xx}^1 +u_{yy}^1+ u_{zz}^1) = 0 \\
&-p_x^1 + \eta (v_{xx}^1 +v_{yy}^1+ v_{zz}^1) = 0 \\
&-p_z^1 + \eta (w_{xx}^1 +w_{yy}^1+ w_{zz}^1) = 0\\
&u_x^1 + u_y^1 + w_z^1 = 0
\end{align}
Surface kinematic equations become:
\begin{align}
&h_t^1 + u_0 h_x^1  = w^1 \label{ht} \\
&s_t^1  + u_0 s_x^1 = w^1 + m^1 \label{st}
\end{align}
We have to linearize the upper and lower surface equations at $z=H +  h^1$
and $z= s^1$ onto $z=H$ and $z=0$.
\\ \\
To do this, we
use the $1^\mathrm{st}$-order Taylor expansion in depth for a function $f(z)$:
$$ f(z^0 + z^1) \approx f(z^0) + f'(z^0)z^1. $$
The stress-free condition at $z=H+h^1$ is approximated at $z=H$ by
\begin{align}
&2\eta w_z^1 - p^1 = -\rho g h^1 \label{pnorm} \\
&\eta(u_z^1 +w_x^1) = 0 \\
&\eta(v_z^1 +w_y^1) = 0
\end{align}
Equation (\ref{pnorm}) states that the perturbed normal stress is balanced
by the perturbed cryostatic stress from the elevation anomaly.
\\ \\
BC's at the lower boundary ($z=0$) become:\\
\textbf{Grounded ice:}
\begin{align}
&w^1  = w_b^1\\
&\eta(u_z^1 + w_x^1) = \beta_0 u^1 + u_0\beta^1 \\
&\eta(v_z^1 +w_y^1) = \beta_0 v^1
\end{align}
\textbf{Floating ice:}
The hydrostatic condition becomes
\begin{align}
2\eta w_z^1 - p^1 = \Delta\rho g s^1
\end{align}
where $\Delta\rho = \rho_w-\rho_i$.
We drop the superscripts below.
\section*{Fourier transform approach}
\subsection*{Grounded ice}
We start with the grounded ice because it is simpler.
Derivatives transform as:
\begin{align}
&\widehat{f_x} = ik_x\widehat{f} \\
&\widehat{f_y} = ik_y\widehat{f} \\
&\widehat{f_{xx}} + \widehat{f_{yy}} = -k^2 \widehat{f}, \\ &k^2 \equiv k_x^2 + k_y^2.
\end{align}
The upper and lower surface kinematic equations (\ref{ht})-(\ref{st}) transform to
\begin{align}
&\widehat{h}_t + u_0 ik_x \widehat{h} = \widehat{w}\label{hthat}\\
&\widehat{s}_t + u_0 ik_x \widehat{s} = \widehat{w}+\widehat{m}.\label{sthat}
\end{align}
The Stokes flow equation become
\begin{align}
&-ik_x\widehat{p} + \eta ( -k^2\widehat{u} + \widehat{u}_{zz}) = 0 \\
&-ik_y\widehat{p} + \eta ( -k^2\widehat{v} + \widehat{v}_{zz}) = 0 \\
&-\widehat{p}_z + \eta (-k^2\widehat{w} + \widehat{w}_{zz}) = 0 \\
&ik_x\widehat{u} + ik_y\widehat{v} + \widehat{w}_z = 0
\end{align}
This can be reduced to a fourth-order equation for the transformed vertical velocity:
\begin{equation}
\widehat{w}_{zzzz} - 2k^2 \widehat{w}_{zz} + k^4 \widehat{w}=0. \label{ode}
\end{equation}
The general solution to (\ref{ode}) is
\begin{align}
\widehat{w} = \frac{A}{k}e^{k z} + \frac{B}{k}e^{-k z} + {C}ze^{k z}+ {D}ze^{-k z},
\end{align}
where $A,B,C,$ and $D$ depend on $k$.\\ \\
To determine the coefficients, we rewrite all the BC's in terms of $\widehat{w}$ and its $z$ derivatives.
The $z$-derivatives of $\widehat{w}$ are:
\begin{align}
&\widehat{w}_{z} = {A}e^{k z} - {B}e^{-k z} + {C}e^{k z} + {C}kze^{k z} - {D}kze^{-k z} + {D}e^{-k z} \\
&\widehat{w}_{zz} = {Ak}e^{k z} + {Bk}e^{-k z} + {2Ck}e^{k z} + {C}k^2 ze^{k z} + {D}k^2ze^{-k z} - {2Dk}e^{-k z} \\
&\widehat{w}_{zzz} = {Ak^2}e^{k z} - {Bk^2}e^{-k z} + {3Ck^2}e^{k z} + {C}k^3 ze^{k z} - {D}k^3ze^{-k z} + {3Dk^2}e^{-k z}
\end{align}
The sliding law becomes
\begin{align}
&\eta( \widehat{u}_z + ik_x \widehat{w}) = \beta_0\widehat{u} + u_0\widehat{\beta} \\
&\eta( \widehat{v}_z + ik_y \widehat{w}) = \beta_0\widehat{v}.
\end{align}
Multiplying through by $-ik_x$ and $-ik_y$, summing the equations, and using the transformed incompressibility
condition reduces this to
\begin{align}
\eta(\widehat{w}_{zz} + k^2 \widehat{w}) = \beta_0 \widehat{w}_z - ik_x   u_0\widehat{\beta}.
\end{align}
Similarly, the shear stress condition at the upper surface becomes
\begin{align}
\eta(\widehat{w}_{zz} + k^2 \widehat{w}) =  0.
\end{align}
The normal stress condition at the upper surface transforms to
$
2\eta \widehat{w}_{z} - \widehat{p} = -\rho g \widehat{h}.
$
From the body equations, we can show that
$-k^2 \widehat{p} = \eta(k^2\widehat{w}_z - \widehat{w}_{zzz}) $, which reduces this to
\begin{align}
\eta (3k^2 \widehat{w}_{z}-\widehat{w}_{zzz})  = -k^2 \rho g \widehat{h}.
\end{align}
To simplify notation, we define the `aspect ratio' $\nu(k) = kH$.\\ \\
The upper surface normal stress BC becomes:
\begin{align}
{A} e^{\nu} - {B} e^{-\nu} + {C}\nu e^{\nu} - {D}\nu e^{-\nu}
=- \frac{\rho g }{2\eta }\widehat{h} \equiv b_1 \label{b1}
\end{align}
The upper surface shear-stress BC becomes:
\begin{align}
A e^{\nu} + B e^{-\nu} + C(\nu+1) e^{\nu} +D(\nu-1) e^{-\nu} =  0
\end{align}
The sliding law BC becomes:
\begin{align}
{A(1-\gamma)} + {B(1+\gamma)} + {C(1-\gamma)}  - {D(1+\gamma)} = -\frac{ ik_x }{2\eta k}u_0\widehat{\beta}\equiv b_2
\end{align}
where we have defined $\gamma(k) = \beta_0/(2\eta k)$. \\
\\ The basal velocity anomaly BC becomes
\begin{align}
{A} + {B}  = k\widehat{w}_b \equiv b_3 \label{b4}
\end{align}
Equations (\ref{b1})-(\ref{b4}) lead to a linear system
...which we solve with SymPy.\\ \\
We can write the anomaly at the surface as
\begin{align}
\widehat{w}|_{z=H} &= \frac{1}{k}\left(e^{\nu} A + { e^{-\nu}}B + \nu e^{\nu} C + {\nu}{ e^{-\nu}} D\right) \\
&= -\mathcal{R}_g\widehat{h} + \mathcal{T}_w\widehat{w}_b  +ik_x u_0  \mathcal{T}_{\beta}  \widehat{\beta}\label{wRT}
\end{align}
According to SymPy, the relaxation frequency $\mathcal{R}_g$ for grounded ice is given by
\begin{align}
\mathcal{R}_g = \left(\frac{\rho_i g }{2\eta k}\right)\frac{ (1+\gamma)e^{4\nu} -(2+4\gamma\nu)e^{2\nu} +1-\gamma  }{ (1+\gamma)e^{4\nu} + (2\gamma+4\nu+4\gamma\nu^2)e^{2\nu} -1 + \gamma  },
\end{align}
the velocity anomaly transfer function $\mathcal{T}_w$ is given by
\begin{align}
\mathcal{T}_w = \frac{2(1+\gamma)(\nu+1)e^{3\nu}+2(1-\gamma)(\nu-1)e^{\nu}  }{(1+\gamma)e^{4\nu} + (2\gamma+4\nu+4\gamma\nu^2)e^{2\nu} -1 + \gamma },
\end{align}
and the friction perturbation transfer function is given by
\begin{align}
\mathcal{T}_{\beta} =  \left(\frac{\nu}{\eta k^2}\right) \frac{e^{3\nu} + e^{\nu}}{e^{4\nu} +4\nu e^{2\nu} -1 },
\end{align}
where we have assumed $\gamma=0$  since $u_0>0$ (otherwise the term vanishes).
In frequency space,
equations (\ref{wRT}) and (\ref{hthat}) lead to the evolution equation
\begin{align}
\frac{\partial \widehat{h}}{\partial t}+ \left[ik_xu_0  + \mathcal{R}_g\right]\widehat{h} = \mathcal{T}_w\widehat{w}_b+ik_xu_0\mathcal{T}_{\beta} \widehat{\beta}. \label{dhhat}
\end{align}

\subsection*{Floating ice}
Here we assume that $\beta=0$.
The main differences here are the hydrostatic lower boundary condition
and that the lower surface evolution is also part of the solution (rather than prescribed).
Analogous to above, the hydrostatic condition becomes
\begin{align}
\eta (3k^2 \widehat{w}_{z}-\widehat{w}_{zzz})  = k^2 \Delta\rho g \widehat{s}. \label{b4alt}
\end{align}
Upon substituting the definition of $\widehat{w}$, this reduces to
\begin{align}
A-B = \frac{\Delta \rho g}{2\eta}\widehat{s},
\end{align}
which replaces equation (\ref{b4}).
Following the same approach as before, the velocity at the upper surface is then given by
\begin{align}
w|_{z=H} =  -\mathcal{R}_f\widehat{h} - \delta\mathcal{B}\widehat{s}
\end{align}
where the relaxation function for floating ice is given by
\begin{align}
\mathcal{R}_f = \left(\frac{\rho_i g}{2\eta k}\right) \frac{e^{4\nu} +4\nu e^{2\nu} -1 }{e^{4\nu} -2(1+2\nu^2)e^{2\nu} +1},
\end{align}
the buoyancy transfer function is given by
\begin{align}
\mathcal{B} = \left(\frac{\rho_i g}{2\eta k}\right) \frac{ 2(\nu+1)e^{3\nu}+2(\nu-1)e^{\nu} }{e^{4\nu} -2(1+2\nu^2)e^{2\nu} +1},
\end{align}
and $\delta = \rho_w/\rho_i -1$.
The upper surface therefore evolves as
\begin{align}
\frac{\partial \widehat{h}}{\partial t}+ \left[ik_xu_0  + \mathcal{R}_f\right]\widehat{h} = -\delta\mathcal{B}\widehat{s}.
\end{align}
We also have to determine the evolution of the lower surface, which evolves in frequency space as
\begin{align}
\frac{\partial \widehat{s}}{\partial t}+ ik_xu_0 \widehat{s} = \widehat{m} + \widehat{w}. \label{stfreq}
\end{align}
Using $\widehat{w}|_{z=0}= \frac{1}{k}(A+B)$, we can find
\begin{align}
\widehat{w}|_{z=0} = -\delta\mathcal{R}_f\widehat{s} - \mathcal{B} \widehat{h}.
\end{align}
Therefore, (\ref{stfreq}) becomes
\begin{align}
\frac{\partial \widehat{s}}{\partial t}+ [ik_xu_0 + \delta\mathcal{R}_f]\widehat{s} = \widehat{m} - \mathcal{B} \widehat{h}.
\end{align}

\subsection*{Velocity solutions}
Here we derive the horizontal surface velocity solutions.
Rearranging the transformed Stokes equations:
\begin{align}
  &  \widehat{u}_{zz}-k^2\widehat{u} = \frac{ik_x}{\eta}\widehat{p} \\
  &  \widehat{v}_{zz}-k^2\widehat{v} = \frac{ik_y}{\eta}\widehat{p}
\end{align}
These have the general solutions
\begin{align}
\widehat{u}(z) = \frac{ik_x }{2\eta k} \left(e^{kz}\int_0^z \widehat{p}(z')e^{-kz'}\;\mathrm{d}z' -
e^{-kz}\int_0^z \widehat{p}(z')e^{kz'}\;\mathrm{d}z'\right)
+ E e^{kz} + F e^{-kz} \\
\widehat{v}(z) = \frac{ik_y }{2\eta k} \left(e^{kz}\int_0^z \widehat{p}(z')e^{-kz'}\;\mathrm{d}z' -
e^{-kz}\int_0^z \widehat{p}(z')e^{kz'}\;\mathrm{d}z'\right)
+ G e^{kz} + H e^{-kz}
\end{align}
where $\{E,F,G,H\}$ depend on the boundary conditions.
As noted before,
\begin{align}
\widehat{p} = \eta\left(\frac{1}{k^2}\widehat{w}_{zzz}-\widehat{w}_z \right).
\end{align}
We substitute this into the integrals above
and integrate the $w_{zzz}$ term by parts twice.
To this end, we use the identity
\begin{align}
\int_0^z \left( \frac{1}{k^2} w_{zzz} - w_{z}\right) e^{\pm kz'}\;\mathrm{d}z'
= \frac{1}{k^2} \left[e^{\pm kz'}w_{zz}\right]_0^z - \frac{\pm k}{k^2}\left[w_ze^{\pm kz'} \right]_0^z
\end{align}
and find that the pressure integrals reduce to
\begin{align}
&e^{kz}\int_0^z \widehat{p}(z')e^{-kz'}\;\mathrm{d}z' -
  e^{-kz}\int_0^z \widehat{p}(z')e^{kz'}\;\mathrm{d}z' \nonumber
  \\ &= \frac{2\eta}{k} \left( \widehat{w}_z-\widehat{w}_z|_{z=0}\cosh(kz) - \frac{1}{k} \widehat{w}_{zz}|_{z=0}\sinh(kz)  \right)
\end{align}
Therefore, we obtain
\begin{align}
&\widehat{u}(z) = \frac{ik_x }{k^2} P(z)
+ E e^{kz} + F e^{-kz} \\
&\widehat{v}(z) = \frac{ik_y }{k^2} P(z) + G e^{kz} + H e^{-kz} \\
&P(z) = \widehat{w}_z-\widehat{w}_z|_{z=0}\cosh(kz) - \frac{1}{k} \widehat{w}_{zz}|_{z=0}\sinh(kz)
\end{align}
We can determine the constants $\{E,F,G,H\}$ from the sliding law and stress-free
upper-surface condition.
First we note that
\begin{align}
&\widehat{u}_z(z) = \frac{ik_x }{k^2} P_z(z)
+ E k e^{kz} - F k e^{-kz} \\
&\widehat{v}_z(z) = \frac{ik_y }{k^2} P_z(z) + G k  e^{kz} - H k e^{-kz} \\
&P_z(z) = \widehat{w}_{zz}-\widehat{w}_z|_{z=0}k\sinh(kz) - \widehat{w}_{zz}|_{z=0}\cosh(kz)\\
&P_z(0) = 0 = P(0).
\end{align}
The stress free condition at $z=H$ (i.e., $\widehat{u}_z = -ik_x \widehat{w}$, etc.)
implies
\begin{align}
 E  e^{\nu} - F  e^{-\nu} &= -\frac{ik_x}{k^2} \left(k\widehat{w}+\frac{1}{k}P_{z}(H)\right)\equiv b_4 \\
  G  e^{\nu} - H  e^{-\nu} &= -\frac{ik_y}{k^2} \left(k\widehat{w}+\frac{1}{k}P_{z}(H)\right) \equiv b_4'.
\end{align}
Note that $b_4=b_4'$ except for the $k_x$ and $k_y$ coefficients.
We rearrange the sliding law as $\widehat{u}_z - \frac{\beta_0}{\eta}\widehat{u}=\frac{u_0}{\eta}\widehat{\beta}
-ik_x\widehat{w}_b$, and do some algebra to find
\begin{align}
&E (1-2\gamma) - F (1+2\gamma) =
\frac{ik_x}{k^2}\left(2\kappa b_2 - b_3 \right)  \equiv b_5 \\
&\kappa = {k}^2/k_x^2
\end{align}
and similarly
\begin{align}
G (1-2\gamma) -H (1+2\gamma) = -\frac{ik_y}{k^2}b_3 \equiv b_5',
\end{align}
which is analogous to $b_5$ but with $\kappa=0$.
At this point, we can solve symbolically for $\{E,F,G,H\}$.
Then, we can solve for the velocity solutions via
\begin{align}
\widehat{u}|_{z=H} =&  \frac{ik_x }{k^2} P(H) + E e^{\nu} + F e^{-\nu}  \\
\widehat{v}|_{z=H} =& \frac{ik_y }{k^2} P(H)+ G e^{\nu} + H e^{-\nu}.
\end{align}
Using SymPy, these can be written in terms of $\{\widehat{h},\widehat{w},\widehat{\beta}\}$ as
\begin{align}
\widehat{u}_H =    \mathcal{U}_{\beta} \widehat{\beta} +ik_x\left(\mathcal{U}_h\widehat{h} -  \mathcal{U}_w\widehat{w}_b\right) \label{uH}\\
\widehat{v}_H =  \mathcal{V}_{\beta} \widehat{\beta}+ik_y\left(\mathcal{V}_h\widehat{h} -  \mathcal{V}_w\widehat{w}_b\right)\label{vH}
\end{align}
where the response functions for the $u-$component are given by...
\begin{align}
& \mathcal{U}_h   =  \frac{\rho g}{2\eta k^2} \left(2\nu (1-e^{2\nu}) e^{\nu} \right)\mathcal{D}^{-1}  \\
& \mathcal{U}_w  = \frac{1}{k}\nu\left( e^{4\nu} - 2e^{2\nu}+1 \right)\mathcal{D}^{-1} \\
& \mathcal{U}_\beta  = \frac{u_0 k_x^2}{2\eta k^3}\left((\nu-2\kappa+1)e^{4\nu} +2\nu(3-4\kappa)e^{2\nu} + \nu+2\kappa-1\right)\mathcal{D}^{-1}  \\
& \mathcal{D}  =  (e^{6\nu} + (4\nu-1)e^{4\nu}- (4\nu+1)e^{2\nu}+1)/(2e^{\nu})
\end{align}
and those for the $v$-component are given by
\begin{align}
  & \mathcal{V}_h = \mathcal{U}_h\\
  & \mathcal{V}_w = \mathcal{U}_w\\
  & \mathcal{V}_\beta  =  \frac{u_0 k_x k_y}{2\eta k^3}\left((\nu+1)e^{4\nu} +6\nu e^{2\nu} + \nu-1\right)\mathcal{D}^{-1} .
\end{align}
In recording these response functions, we have assumed $\gamma=\beta_0=0$
because our focus is on joint beneath ice streams (otherwise $u_0=0$
and the friction perturbation term vanishes). However, the solutions are available
for general $\gamma>0$, just look a bit more complicated (run the \textbf{algebra.py} SymPy code). \\ \\
We scale the velocity equations (\ref{uH}) and (\ref{vH}) via
\begin{align}
u = w_0 u', \;\;\;\; v = w_0v'.
\end{align}
With this scaling, the nondimensional equations are (dropping primes)
\begin{align}
\widehat{u}_H =    \xi\mathcal{U}_{\beta} \widehat{\beta} +ik_x\left(\lambda\mathcal{U}_h\widehat{h} -  \mathcal{U}_w\widehat{w}_b\right) \label{uHsc}\\
\widehat{v}_H =  \xi\mathcal{V}_{\beta} \widehat{\beta}+ik_y\left(\lambda\mathcal{V}_h\widehat{h} -  \mathcal{V}_w\widehat{w}_b\right)\label{vHsc}
\end{align}
where the response functions become
\begin{align}
&\mathcal{U}_h =   \frac{1}{k^2}  \left(2k (1-e^{2k}) e^{k} \right)\mathcal{D}^{-1}   = \mathcal{V}_h \\
&\mathcal{U}_w =  \left( e^{4k} - 2e^{2k}+1 \right)\mathcal{D}^{-1}  = \mathcal{V}_w \\
&\mathcal{U}_\beta =   \frac{k_x^2}{k^3} \left((k-2\kappa+1)e^{4k} +2\nu(3-4\kappa)e^{2k} + \nu+2\kappa-1\right)\mathcal{D}^{-1}   \\
&\mathcal{V}_\beta =  \frac{k_x k_y}{k^3} \left((k+1)e^{4k} +6k e^{2k} + k-1\right)\mathcal{D}^{-1}\\
& \mathcal{D}  =  (e^{6k} + (4k-1)e^{4k}- (4k+1)e^{2k}+1)/(2e^{k})
\end{align}
with $k=\nu$ ($k_x \gets Hk_x$, $k_y \gets Hk_y$) in the scaled equations.
\end{document}
